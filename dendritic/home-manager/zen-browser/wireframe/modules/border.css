/* === BORDER === */

/* === OUTER BROWSER BORDER FIX === */
/* Force zero border-radius on all possible browser container elements */
:root,
#main-window,
#navigator-toolbox,
#titlebar,
#TabsToolbar,
.browserContainer,
#appcontent,
#browser,
.browserSidebarContainer,
#zen-tabbox-wrapper,
#zen-appcontent-wrapper,
body,
body > hbox,
#zen-main-app {
    border-radius: 0px;
    border-radius: 0;
}

/* Specifically target the outermost window elements */
window,
#main-window,
:root[sizemode="normal"],
:root[sizemode="maximized"] {
    border-radius: 0px !important;
    border-radius: 0 !important;
}

/* Ensure the main browser area has sharp corners */
#browser {
    border-radius: 0px !important;
    -moz-appearance: none !important;
    appearance: none !important;
    overflow: clip !important;
    padding: 0px !important;
}

body > hbox {
    border-radius: 0px !important;
    /* background: var(--na-color-bg) !important; */
}

/* ====== WINDOW BORDERS ====== */
@media (-moz-pref("wireframe.window.border", "wireframe")){
    :root[sizemode="maximized"] #browser::before {
        content: "";
        position: absolute;
        inset: 0;
        border: 2px solid var(--na-color-border);
        pointer-events: none;
        z-index: 9999;
    }
    
    :root[sizemode="normal"] #browser::before {
        content: "";
        position: absolute;
        inset: 0;
        border: 2px solid var(--na-color-border);
        border-radius: var(--na-window-border-radius) !important;
        pointer-events: none;
        z-index: 9999;
    }
}

@media (-moz-pref("wireframe.window.border", "macos")){
    :root[sizemode="normal"] #browser::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      border-radius: var(--na-window-border-radius) !important;
      z-index: 9999;
      transform: translateZ(0);
      will-change: box-shadow, opacity;

      box-shadow:
        /* --- corner mask (prevents corner bleed) --- */
        inset 0 0 0 1px light-dark(
          rgba(255,255,255,0.14),
          rgba(255,255,255,0.10)
        ),

        /* --- curved metal highlight --- */
        inset 0 0 0 2px light-dark(
          rgba(255,255,255,0.32),
          rgba(255,255,255,0.18)
        ),

        /* --- inner soft falloff (curved depth) --- */
        inset 0 0 10px 4px light-dark(
          rgba(0,0,0,0.05),
          rgba(255,255,255,0.07)
        ),

        /* --- machined outer rim --- */
        0 0 0 2px light-dark(
          rgba(0,0,0,0.27),
          rgba(255,255,255,0.30)
        ),

        /* --- outer structural ring --- */
        0 3px 6px 1px light-dark(
          rgba(0,0,0,0.08),
          rgba(255,255,255,0.08)
        ),

        /* --- diffused Sonoma glow --- */
        0 0 32px 10px color-mix(in srgb, accentcolor 55%, transparent),
        0 0 64px 26px color-mix(in srgb, accentcolor 40%, transparent),
        0 0 110px 60px color-mix(in srgb, accentcolor 28%, transparent);

    }
}

:root[sizemode="fullscreen"] #browser::before {
    border: 0 !important;
    border-radius: 0px !important;
    outline: none !important;
    outline-offset: 0px !important;
}

:root[inDOMFullscreen="true"] #browser::before {
    border: 0 !important;
    border-radius: 0px !important;
    outline: none !important;
    outline-offset: 0px !important;
}

/* Ensure all browser elements have squared corners */
:root #browser,
:root body * {
    border-radius: 0;
}

:root[sizemode="normal"] #zen-browser-background {
    border-radius: var(--na-window-border-radius) !important;
}

/* window border on spit tabs */
/* :root:has(#tabbrowser-tabpanels [zen-split]) .deck-selected {
    border-radius: 0px !important;
    border: 2px solid var(--na-color-border) !important;
} */

:root:has(#tabbrowser-tabpanels [zen-split]) #tabbrowser-tabpanels > * {
    border-radius: 0 !important;
}

/* :root:has(#tabbrowser-tabpanels [zen-split]) .deck-selected {
    border-radius: var(--na-window-border-radius) !important;
} */

:root:has(#tabbrowser-tabpanels [zen-split]) .browserSidebarContainer {
    box-shadow: none !important;
}

:root:has(#tabbrowser-tabpanels [zen-split]) .browserSidebarContainer[is-zen-split="true"] {
    margin: 0 0 !important;
}

/* content window border radius */

:root:has([zen-compact-mode="true"]):has([zen-single-toolbar="true"]):not(
        [inDOMFullscreen="true"]
    )
    .browserSidebarContainer {
    border-radius: var(--na-window-border-radius) !important;
}

:root:not([sizemode="normal"]) .browserSidebarContainer {
    border-radius: 0 !important;
}

/* ====== WEBVIEW BORDER ====== */
@media not (-moz-pref("wireframe.webview.border")){
    /* content window border size on RIGHT side tabbar */
    :root[zen-right-side="true"]:not([zen-compact-mode="true"]):not(
            [inDOMFullscreen="true"]
        )
        #zen-tabbox-wrapper {
        border: 0.1px solid transparent !important;
    }

    /* content window border size on LEFT side tabbar */
    :root:not([zen-right-side="true"]):not([zen-compact-mode="true"]):not(
            [inDOMFullscreen="true"]
        )
        #zen-tabbox-wrapper {
        border: 0.1px solid transparent !important;
    }
}

@media (-moz-pref("wireframe.webview.border", "wireframe")){
    /* content window border size on RIGHT side tabbar */
    :root[zen-right-side="true"]:not([zen-compact-mode="true"]):not(
            [inDOMFullscreen="true"]
        )
        #zen-tabbox-wrapper {
        border: 2px solid var(--na-color-border) !important;
    }

    /* content window border size on LEFT side tabbar */
    :root:not([zen-right-side="true"]):not([zen-compact-mode="true"]):not(
            [inDOMFullscreen="true"]
        )
        #zen-tabbox-wrapper {
        border: 2px solid var(--na-color-border) !important;
    }
}

@media (-moz-pref("wireframe.webview.border", "macos")) {

  :root:not([zen-compact-mode="true"]):not([inDOMFullscreen="true"])

  #zen-tabbox-wrapper::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      border-radius: var(--na-user-border-radius);
      z-index: 9999;

      box-shadow:
        /* --- micro corner mask (softened) --- */
        inset 0 0 0 1px rgba(255,255,255,0.10),

        /* --- milky curved highlight (the secret sauce) --- */
        inset 0 0 0 2px rgba(255,255,255,0.22),

        /* --- concave falloff (boosted softness) --- */
        inset 0 0 12px 6px rgba(0,0,0,0.06),

        /* --- softened outer rim (less harsh) --- */
        0 0 0 1px rgba(0,0,0,0.18),

        /* --- light spread glow (barely visible, creates “milkiness”) --- */
        0 0 12px 5px rgba(255,255,255,0.10),

        /* --- depth ring (slightly larger, softer) --- */
        0 2px 5px rgba(0,0,0,0.08);
  }
}



/* fix for overflowing borders when webview border is off */
@media not (-moz-pref("wireframe.webview.border")){
    /* content window border size on RIGHT side tabbar */
    :root[zen-right-side="true"]:not([zen-compact-mode="true"]):not(
            [inDOMFullscreen="true"]
        )
        #zen-tabbox-wrapper {
        border: 0.1px solid transparent !important;
    }

    /* content window border size on LEFT side tabbar */
    :root:not([zen-right-side="true"]):not([zen-compact-mode="true"]):not(
            [inDOMFullscreen="true"]
        )
        #zen-tabbox-wrapper {
        border: 0.1px solid transparent !important;
    }
}

/* remove content window border on split tabs*/
/* :root:has(#tabbrowser-tabpanels [zen-split]) #zen-tabbox-wrapper {
    border: none !important;
} */

/* content window bottom margin on SINGLE-TOOLBAR mode */
/* @media (-moz-bool-pref: "zen.view.use-single-toolbar") {
  :root[zen-sidebar-expanded="true"]:not([zen-compact-mode="true"]):not([inDOMFullscreen="true"]) #zen-tabbox-wrapper {
    margin-bottom: var(--na-window-margin) !important;
  }
} */

/* @media (-moz-pref("zen.view.use-single-toolbar")) {
  @media not (-moz-bool-pref: "wireframe.urlbar.position.top"){
    :root[zen-sidebar-expanded="true"]:not([zen-compact-mode="true"]):not([inDOMFullscreen="true"]) #zen-tabbox-wrapper {
      margin-bottom: calc( var(--na-window-margin) - 10px ) !important;
    }
  }
} */

/* content window + address bar */
#zen-appcontent-wrapper {
    /* background-color: var(--na-color-bg) !important; */
    border-radius: 0px !important;
    /*! margin: 0px !important; */
    padding: 0px !important;
    overflow: hidden !important;
}

/* window */
#zen-tabbox-wrapper {
    box-shadow: none !important;
    overflow: clip !important;
    padding: 0px !important;
    /*! background-color: var(--na-color-bg) !important; */
    overflow: hidden !important;
    padding: 0px !important;
    background-clip: padding-box !important;
}

/* WEBVIEW BORDER RADIUS */

#tabbrowser-tabbox,
#tabbrowser-tabbox > * {
    margin: 0 !important;
    padding: 0 !important;
    box-sizing: border-box !important;
}

:root[zen-right-side="true"]:not([zen-compact-mode="true"]):not(
        [inDOMFullscreen="true"]
    )
    #zen-tabbox-wrapper {
    border-radius: var(--na-user-border-radius) !important;
}

:root:not([zen-right-side="true"]):not([zen-compact-mode="true"]):not(
        [inDOMFullscreen="true"]
    )
    #zen-tabbox-wrapper {
    border-radius: var(--na-user-border-radius) !important;
}

/* ADD WEBVIEW BORDER RADIUS TO CHILDREN ELEMENTS OF TABBOX */
:root:not([zen-compact-mode="true"]) {
/*     @media not (-moz-pref("wireframe.nogaps.enabled")) { */
        #tabbrowser-tabpanels {
            border-radius: var(--na-user-border-radius) !important;
        }

        #tabbrowser-tabpanels > * {
            border-radius: inherit !important;
            transition: border-radius 0.18s linear !important;
        }
/*     } */
}

:root:has([zen-compact-mode="true"]):has([sizemode="normal"])
    ):has(#zen-appcontent-navbar-wrapper[zen-has-hover="false"]) {
    #zen-tabbox-wrapper {
        border-radius: var(--na-window-border-radius) !important;
    }

    #tabbrowser-tabbox,
    #tabbrowser-tabbox > * {
        border-radius: var(--na-window-border-radius) !important;
    }
}

:root[inDOMFullscreen="true"] {
    #tabbrowser-tabpanels {
        border-radius: 0 !important;
    }
}


/* NO GAPS COMPACT MODE (DEFAULT) */

:root[zen-single-toolbar="true"][zen-compact-mode="true"]:not([customizing]) {
    /* Credits to CompTechGuy */
    #zen-appcontent-navbar-wrapper {
        min-height: 0.1px !important;
        height: 0.1px !important;
    }

    #zen-appcontent-navbar-wrapper[zen-has-hover="true"] {
        height: 34px !important;
    }

    --zen-element-separation: 0px !important;

    #zen-tabbox-wrapper,
    #tabbrowser-tabbox,
    #tabbrowser-tabbox > * {
        border-radius: var(--na-window-border-radius) !important;
    }
}

/* FIX : REMOVE NAVBAR CONTAINER WHEN EMPTY */
:root[zen-single-toolbar="true"][zen-compact-mode="true"]:not(
        [customizing]
    ):has(#PersonalToolbar[collapsed]) {
    @media (-moz-pref("zen.view.experimental-force-window-controls-left")) {
        #zen-appcontent-navbar-wrapper {
            height: 0.1px !important;
        }
    }
}

:root:not([zen-single-toolbar="true"])[zen-compact-mode="true"]:not(
        [customizing]
    ) {
    /* Credits to CompTechGuy */

    /* TODO: ADD HIDE PREF FOR MULTI TOOLBAR TOPBAR !!! */

    /*   #zen-appcontent-navbar-wrapper {
	  min-height: 0.1px !important;
		height: 0.1px !important;
    transition: 0.18s ease !important;
	}

	#zen-appcontent-navbar-wrapper[zen-has-hover="true"] {
	  height: 34px !important;
	} */

    --zen-element-separation: 0px !important;

    @media not (-moz-pref("wireframe.urlbar.position.top")) {
        #zen-tabbox-wrapper,
        #tabbrowser-tabbox,
        #tabbrowser-tabbox > *,
        .browserSidebarContainer,
        .browserSidebarContainer > * {
            border-bottom-left-radius: 0 !important;
            border-bottom-right-radius: 0 !important;
        }
    }

    @media (-moz-pref("wireframe.urlbar.position.top")) {
        #zen-tabbox-wrapper,
        #tabbrowser-tabbox,
        #tabbrowser-tabbox > *,
        .browserSidebarContainer,
        .browserSidebarContainer > * {
            border-top-left-radius: 0 !important;
            border-top-right-radius: 0 !important;
        }
    }
}

:root:not([zen-single-toolbar="true"])[zen-compact-mode="true"][sizemode="normal"] #browser,
:root:not([zen-single-toolbar="true"])[zen-compact-mode="true"][sizemode="normal"] #main-window{
  overflow: hidden !important;
  clip-path: inset(0 round var(--na-window-border-radius));
}

/* fix for corner bleeding in single toolbar compact mode */
:root[zen-single-toolbar="true"][zen-compact-mode="true"][sizemode="normal"] #browser,
:root[zen-single-toolbar="true"][zen-compact-mode="true"][sizemode="normal"] #main-window {
    overflow: hidden !important;
    clip-path: inset(0 round var(--na-window-border-radius));
}

/* fix for rounded corners in maximised compact mode */
:root:not([sizemode="normal"])[zen-compact-mode="true"]:not([customizing]){
    #zen-tabbox-wrapper,
    #tabbrowser-tabbox,
    #tabbrowser-tabbox > * {
        border-radius: 0 !important;
    }
}

/* BORDER FOR MULTI TOOLBAR TOP BAR */
:root:not([zen-single-toolbar="true"])[zen-compact-mode="true"] {
    @media not (-moz-pref("wireframe.urlbar.position.top")) {
        #zen-appcontent-navbar-wrapper {
            border-top: 2px solid var(--na-color-border) !important;
        }
    }

    @media (-moz-pref("wireframe.urlbar.position.top")) {
        #zen-appcontent-navbar-wrapper {
            border-bottom: 2px solid var(--na-color-border) !important;
        }
    }
}

/* === Webview Border Radius Pref === */
@media (-moz-pref("wireframe.webview.border_radius", 0)) {
    :root {
        --na-user-border-radius: 0px;
    }
}

@media (-moz-pref("wireframe.webview.border_radius", 4)) {
    :root {
        --na-user-border-radius: 4px;
    }
}

@media (-moz-pref("wireframe.webview.border_radius", 8)) {
    :root {
        --na-user-border-radius: 8px;
    }
}

@media (-moz-pref("wireframe.webview.border_radius", 12)) {
    :root {
        --na-user-border-radius: 12px;
    }
}

@media (-moz-pref("wireframe.webview.border_radius", 16)) {
    :root {
        --na-user-border-radius: 16px;
    }
}

@media (-moz-pref("wireframe.webview.border_radius", 20)) {
    :root {
        --na-user-border-radius: 20px;
    }
}

/* === Window border radius pref === */
@media (-moz-pref("wireframe.window.border_radius", 0)) {
    :root {
        --na-window-border-radius: 0px;
    }
}

@media (-moz-pref("wireframe.window.border_radius", 4)) {
    :root {
        --na-window-border-radius: 4px;
    }
}

@media (-moz-pref("wireframe.window.border_radius", 8)) {
    :root {
        --na-window-border-radius: 8px;
    }
}

@media (-moz-pref("wireframe.window.border_radius", 12)) {
    :root {
        --na-window-border-radius: 12px;
    }
}

@media (-moz-pref("wireframe.window.border_radius", 16)) {
    :root {
        --na-window-border-radius: 16px;
    }
}

@media (-moz-pref("wireframe.window.border_radius", 20)) {
    :root {
        --na-window-border-radius: 20px;
    }
}

@media (-moz-pref("wireframe.window.border_radius", 24)) {
    :root {
        --na-window-border-radius: 24px;
    }
}

/* === NO GAPS === */

@media (-moz-pref("wireframe.nogaps.enabled")){
    :root[zen-single-toolbar="true"]{
        --zen-element-separation: 0px !important;
    }
    
    :root[zen-single-toolbar="true"]:not([zen-right-side="true"]):not([zen-compact-mode="true"]){
        #zen-tabbox-wrapper,
        #tabbrowser-tabbox,
        #tabbrowser-tabpanels,
        #tabbrowser-tabpanels > * {
            border-top-left-radius: 0px !important;
            border-bottom-left-radius: 0px !important;
            border-top-right-radius: 0px !important;
            border-bottom-right-radius: 0px !important;
        }
        
        #zen-tabbox-wrapper{
            border: none !important;
        }
        
        #zen-tabbox-wrapper::before {
            box-shadow: none !important;
        }
    }
    
    :root[zen-single-toolbar="true"][zen-right-side="true"]:not([zen-compact-mode="true"]){
        #zen-tabbox-wrapper,
        #tabbrowser-tabbox,
        #tabbrowser-tabpanels,
        #tabbrowser-tabpanels > * {
            border-top-right-radius: 0px !important;
            border-bottom-right-radius: 0px !important;
            border-top-left-radius: 0px !important;
            border-bottom-left-radius: 0px !important;
        }
        
        #zen-tabbox-wrapper{
            border: none !important;
        }
        
        #zen-tabbox-wrapper::before {
            box-shadow: none !important;
        }
    }
}



/* fix for transparent blank page */
.browserStack {
    browser {
        background-color: transparent !important;
    }
}

/* ====== PREVIOUS/NEXT ANIMATION ====== */

/* Always animate back and forth */
browser {
  @media (-moz-pref("wireframe.trackpad.animation")) {
    transition: transform 0.33s ease, scale 0.33s ease, border-radius 0.33s ease !important;
  }
}

/* Previous animation */
.browserStack:has(
    #historySwipeAnimationPreviousArrow:not([style="translate: none;"])
) browser {
  @media (-moz-pref("wireframe.trackpad.animation")) {
    scale: 0.95 !important;
    transform: translateX(3%) !important;
    border-radius: var(--na-user-border-radius) !important;
  }
}

/* Next animation */
.browserStack:has(
    #historySwipeAnimationNextArrow:not([style="translate: none;"])
) browser {
  @media (-moz-pref("wireframe.trackpad.animation")) {
    scale: 0.95 !important;
    transform: translateX(-3%) !important;
    border-radius: var(--na-user-border-radius) !important;
  }
}
